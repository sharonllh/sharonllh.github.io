---
layout: post
title: DDIA阅读笔记(1)：可靠性、可伸缩性和可维护性
date: 2024-03-03 +0800
tags: [系统设计, DDIA]
categories: [系统设计]
---

## 数据密集型 VS 计算密集型

数据密集型应用的瓶颈在于数据量大、数据复杂性高、数据变化快，计算密集型应用的瓶颈在于CPU。

## 数据系统的标准组件

- 数据库（database）: 存储数据
- 缓存（cache）：加快读取速度
- 搜索引擎（search index）：允许用户按关键字搜索数据，或过滤数据
- 流处理（stream processing）：向其他进程发送消息，进行异步处理
- 批处理（batch processing）：定期处理累积的大批量数据

## 数据系统的非功能性要求

- 可靠性（reliability）
- 可伸缩性（scalability）
- 可维护性（maintainability）

### 可靠性（reliability）

可靠性表示系统在发生硬件故障、软件故障和人为错误时依然可以正常工作的能力。

提高可靠性的方法：

- 硬件故障
    - 增加硬件冗余
    - 引入软件容错机制
- 软件故障
    - 开发时仔细考虑各种假设
    - 进行严格的测试（单元测试、集成测试、手动测试）
    - 进程隔离（避免一个程序的崩溃影响到其他程序）
    - 允许进程崩溃并重启（后台定期检查进程的heartbeart并在需要时重启）
    - 监控程序运行情况，发生故障时及时警告
- 人为错误
    - 设计系统时充分考虑人为操作的不可靠性，从流程上避免错误操作（限制一些危险操作、增加审查环节、灰度发布）
    - 进行严格的测试（单元测试、集成测试、手动测试）
    - 提供测试环境（沙箱），让开发人员在不影响真实用户的情况下充分测试    - 
    - 允许从人为错误中快速恢复（快速回滚代码和配置变更）
    - 监控程序运行情况，发生故障时及时警告

### 可伸缩性（scalability）

可伸缩性表示系统在负载增长的情况下依然可以保持性能的能力。

#### 如何描述负载？

根据系统架构选择不同的负载参数：
- 对于web服务，负载参数可能是web服务器每秒收到的请求数（RPS）
  >Q: 那些到达了机器但没能进入web服务的请求需要算进去吗？
- 对于数据库软件，负载参数可能是数据库的读写速率
- 对于聊天软件，负载参数可能是聊天室中同时活跃的用户数

#### 如何描述性能？

根据系统架构选择不同的性能指标：
- 对于web服务，性能指标通常是服务的响应时间，常用P95、P99和P99.9等百分位数衡量
- 对于批处理系统，性能指标通常是吞吐量（throughput），即每秒处理的数据量

#### 如何衡量可伸缩性？

除了描述负载和性能，还需要考虑到系统资源（CPU、内存、网络带宽等）的使用情况。可以从两个角度来衡量可伸缩性：
- 当负载增加时，保持系统资源不变，性能会受到什么影响？
- 当负载增加时，为了保持性能不受影响，需要增加多少系统资源？

#### 如何实现可伸缩？
- 纵向伸缩（scaling up）：提升机器的性能
- 横向伸缩（scaling out）：增加机器的数量

### 可维护性（maintainability）

系统的维护包括：
- 修复漏洞
- 添加新的功能
- 升级框架版本
- 适配新的平台

如何提高可维护性：
- 通过抽象，消除额外复杂度（由具体实现带来的，而不是问题固有的复杂度）
- 遵循代码规范（命名、默认值等），方便其他人理解和修改
- 提供对系统健康状态的监控，方便及时发现问题
- 当系统出现问题时，尽量自我修复，必要时再人为修复
- 建立部署、配置和管理系统的良好实践，编写工具和文档