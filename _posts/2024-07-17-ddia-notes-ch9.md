---
layout: post
title: DDIA阅读笔记(9)：分布式数据系统的一致性与共识
date: 2024-07-17 +0800
tags: [系统设计, DDIA]
categories: [系统设计]
---

共识（consensus）：所有节点对某件事达成一致。

共识是分布式系统最重要的抽象之一。一旦达成共识，应用可以将其用于各种目的。例如，对于一个单主复制的数据库，如果主库挂掉了，需要切换到另一个节点，剩余的节点可以使用共识来推举新的领导者。

## 一致性保证

最终一致性：所有副本最终会收敛到相同的值。这意味着，如果停止向数据库写入数据并等待一段时间，最终所有的读取请求都会返回相同的值。这个保证非常弱，因为它并不保证什么时候副本会收敛。

更强的一致性保证可能具有更差的性能和更少的容错性。

## 线性一致性

线性一致性（linearizability）：又称强一致性（strong consistency），基本思想是让系统看起来好像只有一个数据副本，并且所有操作都是原子性的。

如下所示，为了实现线性一致性，需要满足以下条件：
- 如果读操作在写操作之前完成，必须返回旧值。例如，客户端A的第一次读取返回0。
- 如果读操作在写操作之后完成，必须返回新值。例如，客户端A的第三次读取返回1。
- 如果读操作和写操作同时发生，可能返回旧值或新值。然而，一旦一个客户端的读取返回新值，所有后续读取都必须返回新值。例如，客户端B的第一次读取返回0，但是客户端A的第二次读取返回1，所以客户端B的第二次读取也必须返回1。

![DistributedData LinearizabilityExample](/assets/img/DDIA_DistributedData_LinearizabilityExample.png)

### 依赖线性一致性的例子



## 顺序保证

## 分布式事务与共识